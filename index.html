<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kanji Snap</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b1220">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header class="header">
        <div>
          <div class="title">Kanji Snap</div>
        </div>

        <nav class="tabs" role="tablist" aria-label="Main tabs">
          <button class="tab active" id="tabHome" type="button">Home</button>
          <button class="tab" id="tabSettings" type="button">Settings</button>
          <button class="tab" id="tabDictionary" type="button">Dictionary</button>
          <button class="tab" id="tabKanji" type="button">Kanji</button>
          <button class="tab" id="tabDemo" data-tab="demo" type="button">Demo</button>
          <button class="tab" id="tabGame" type="button" style="display:none;">Game</button>

          <!-- ✅ Debug tab -->
          <button class="tab" id="tabDebug" data-tab="debug" type="button">Debug</button>
        </nav>
      </header>

      <!-- HOME -->
      <section class="view active" id="viewHome" aria-labelledby="tabHome">
        <div class="row">
          <div class="pill" id="homePill">Active: …</div>
          <button class="btn" id="startBtn" type="button">Start game</button>
        </div>

        <div class="sectionTitle">Game rules</div>
        <div class="muted">
          Start with <b>10 lives</b>. Wrong answer: <b>-3 lives</b>. Sneak Peek: <b>-1 life</b> (charged once per question).
          <br>
          Some questions can be <b>compound</b> questions (word in hiragana). You must select <b>two kanji</b>.
          First pick turns <b>blue</b> (selection). Second pick reveals correct (green) and incorrect (red).
        </div>

        <div class="sectionTitle">Dictionary</div>
        <div class="muted">Look up kanji outside the game.</div>

        <div class="row" style="margin-top:12px;">
          <button class="btn" id="goDictionaryBtn" type="button">Open dictionary</button>
          <button class="btn" id="goSettingsBtn" type="button">Open settings</button>
          <button class="btn" id="goKanjiBtn" type="button">Pick kanji</button>
        </div>
      </section>

      <!-- SETTINGS -->
      <section class="view" id="viewSettings" aria-labelledby="tabSettings">
        <div class="row">
          <div>
            <div class="sectionTitle">Settings</div>
            <div class="muted">Select grades, download images per grade, and choose quiz options.</div>
          </div>
          <button class="btn" id="backHomeBtn" type="button">Back</button>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Grades</div>
          <div class="muted">Choose which grades are active.</div>
          <div id="gradeList"></div>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Images</div>
          <div class="muted">Download or clear cached meaning images for the active grades.</div>

          <div class="row" style="margin-top:10px;">
            <button class="btn" id="downloadImagesBtn" type="button">Download images</button>
            <button class="btn" id="clearImagesBtn" type="button">Clear images</button>
          </div>

          <div class="row" style="margin-top:10px;">
            <div class="pill" id="imagesStatusPill">Cached: …</div>
          </div>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Quiz types</div>
          <div class="muted">Enable additional question styles.</div>

          <label class="check">
            <input type="checkbox" id="compoundEnabled">
            Compound questions (hiragana word → tap 2 kanji)
          </label>

          <label class="check">
            <input type="checkbox" id="dragWordEnabled">
            Drag word questions (hiragana → drag kanji into zones)
          </label>
        </div>
      </section>

      <!-- DICTIONARY -->
      <section class="view" id="viewDictionary" aria-labelledby="tabDictionary">
        <div class="row">
          <div>
            <div class="sectionTitle">Dictionary</div>
            <div class="muted">Search kanji and view details.</div>
          </div>
          <button class="btn" data-tab="home" type="button">Back</button>
        </div>

        <div class="dictTop">
          <input class="input" id="dictSearchInput" type="text" placeholder="Search by kanji, meaning, reading…" />
          <button class="btn" id="dictSearchBtn" type="button">Search</button>
        </div>

        <div class="dictLayout">
          <div class="dictListPane">
            <div class="dictListHeader">
              <div class="sectionTitle" style="margin:0;">Results</div>
              <div class="pill pillTiny" id="dictCountPill">0</div>
            </div>
            <div id="dictList" class="dictList"></div>
          </div>

          <div class="dictDetailPane">
            <div id="dictDetailEmpty" class="dictDetailEmpty">Select a result to see details.</div>

            <div id="dictDetail" style="display:none;">
              <div class="dictDetailHeader">
                <div class="dictBigKanji" id="dictBigKanji">?</div>
                <div>
                  <div class="chips" id="dictChips"></div>
                </div>
              </div>

              <div class="dictRows" style="margin-top:12px;">
                <div class="dictKey">Meaning</div>
                <div class="dictVal" id="dictMeaning"></div>

                <div class="dictKey">On</div>
                <div class="dictVal" id="dictOn"></div>

                <div class="dictKey">Kun</div>
                <div class="dictVal" id="dictKun"></div>

                <div class="dictKey">Grade</div>
                <div class="dictVal" id="dictGrade"></div>
              </div>

              <div class="sectionTitle" style="margin-top:14px;">Words</div>
              <div id="dictWords"></div>

              <div class="sectionTitle" style="margin-top:10px;">Raw word JSON</div>
              <pre class="mono" id="wordRaw"></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- KANJI -->
      <section class="view" id="viewKanji" aria-labelledby="tabKanji">
        <div class="row">
          <div>
            <div class="sectionTitle">Pick kanji</div>
            <div class="muted">Toggle which kanji are active in the pool.</div>
          </div>
          <button class="btn" data-tab="home" type="button">Back</button>
        </div>

        <div id="kanjiGroups"></div>
      </section>

      <!-- DEMO: Sentence layout prototype (static for now) -->
      <section class="view" id="viewDemo" data-view="demo" aria-labelledby="tabDemo">
        <div class="row">
          <div>
            <div class="sectionTitle">Demo: Sentence layout</div>
            <div class="muted">
              Static layout prototype for future sentence drag-and-drop questions.
              Bottom is a large prompt tile; top is a 2×4 answer grid.
            </div>
          </div>
          <button class="btn" data-tab="home" type="button">Back</button>
        </div>

        <!-- ✅ Sentence board layout: rows 1-2 answers, row 3 prompt -->
        <div id="demoGrid" class="demoGrid demoSentenceBoard" style="margin-top:10px;">

          <!-- Answers container -->
          <div class="choices" id="demoChoices">
            <button class="choice" id="demoChoice0" type="button"><span class="choiceKanji" id="demoChoice0Text">?</span></button>
            <button class="choice" id="demoChoice1" type="button"><span class="choiceKanji" id="demoChoice1Text">?</span></button>
            <button class="choice" id="demoChoice2" type="button"><span class="choiceKanji" id="demoChoice2Text">?</span></button>
            <button class="choice" id="demoChoice3" type="button"><span class="choiceKanji" id="demoChoice3Text">?</span></button>
            <button class="choice" id="demoChoice4" type="button"><span class="choiceKanji" id="demoChoice4Text">?</span></button>
            <button class="choice" id="demoChoice5" type="button"><span class="choiceKanji" id="demoChoice5Text">?</span></button>
            <button class="choice" id="demoChoice6" type="button"><span class="choiceKanji" id="demoChoice6Text">?</span></button>
            <button class="choice" id="demoChoice7" type="button"><span class="choiceKanji" id="demoChoice7Text">?</span></button>
          </div>

          <!-- Prompt tile -->
          <div class="prompt" id="demoPrompt">
            <div class="promptInner">
              <div class="kanaText" id="demoPromptText"></div>
            </div>
          </div>
        </div>

        <div class="row" style="margin-top:10px; justify-content:flex-end;">
          <button class="btn" id="demoResetBtn" type="button">Reset</button>
        </div>
      </section>

      <!-- GAME -->
      <section class="view" id="viewGame" aria-labelledby="tabGame">
        <!-- ✅ shared 2x3 board wrapper (used for dragword layouts) -->
        <div id="qaGrid" class="qaGrid">
          <div class="prompt" id="prompt" title="Tap to Sneak Peek">
            <div class="promptHud" aria-hidden="true">
              <div class="promptHudItem" id="hudLives">❤️ 10</div>
              <div class="promptHudItem" id="hudScore">0</div>
            </div>

            <div class="promptInner" id="promptInner">
              <div class="kanjiText">？</div>
            </div>
          </div>

          <div class="choices" id="choices"></div>
        </div>

        <div class="history">
          <div class="historyHeader">
            <div class="historyTitle">History</div>
            <div class="historyHint">Tap a row to view details (no penalty).</div>
          </div>
          <div id="historyList"></div>
        </div>
      </section>

      <!-- DEBUG -->
      <section class="view" id="viewDebug" data-view="debug" aria-labelledby="tabDebug">
        <div class="row">
          <div>
            <div class="sectionTitle">Debug</div>
            <div class="muted">Runtime info to help diagnose loading/caching issues.</div>
          </div>
          <button class="btn" id="debugRefreshBtn" type="button">Refresh</button>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Versions</div>
          <div id="debugVersions" class="debugGrid"></div>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Totals</div>
          <div id="debugTotals" class="debugGrid"></div>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Notes</div>
          <div class="muted" id="debugNotes">
            Images cached count reflects items in <code>kanji-snap-runtime-v1</code> under <code>/images/meaning/cartoon/</code>.
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Game Over Modal -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2 id="gameOverTitle">Game over</h2>
      <p id="gameOverText">Final score: 0</p>
      <div class="actions">
        <button class="btn" id="gameOverOk" type="button">Back to Home</button>
      </div>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
