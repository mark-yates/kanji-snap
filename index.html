<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kanji Snap</title>

  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b1220">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="stylesheet" href="./styles.css">
</head>

<body>
  <div class="wrap">
    <div class="card">
      <header class="header">
        <div>
          <div class="title">Kanji Snap</div>
        </div>

        <nav class="tabs" role="tablist" aria-label="Main tabs">
          <button class="tab active" id="tabHome" type="button">Home</button>
          <button class="tab" id="tabSettings" type="button">Settings</button>
          <button class="tab" id="tabDictionary" type="button">Dictionary</button>
          <button class="tab" id="tabKanji" type="button">Kanji</button>
          <button class="tab" id="tabGame" type="button" style="display:none;">Game</button>
        </nav>
      </header>

      <!-- HOME -->
      <section class="view active" id="viewHome" aria-labelledby="tabHome">
        <div class="row">
          <div class="pill" id="homePill">Active: …</div>
          <button class="btn" id="startBtn" type="button">Start game</button>
        </div>

        <div class="sectionTitle">Game rules</div>
        <div class="muted">
          Start with <b>10 lives</b>. Wrong answer: <b>-3 lives</b>. Sneak Peek: <b>-1 life</b> (charged once per question).
          <br>
          Some questions can be <b>compound</b> questions (word in hiragana). You must select <b>two kanji</b>.
          First pick turns <b>blue</b> (selection). Second pick reveals correct (green) and incorrect (red).
        </div>

        <div class="sectionTitle">Dictionary</div>
        <div class="muted">Look up kanji outside the game.</div>

        <div class="row" style="margin-top:12px;">
          <button class="btn" id="goDictionaryBtn" type="button">Open dictionary</button>
          <button class="btn" id="goSettingsBtn" type="button">Open settings</button>
          <button class="btn" id="goKanjiBtn" type="button">Pick kanji</button>
        </div>
      </section>

      <!-- SETTINGS -->
      <section class="view" id="viewSettings" aria-labelledby="tabSettings">
        <div class="row">
          <div>
            <div class="sectionTitle">Settings</div>
            <div class="muted">Select grades, download images per grade, and choose quiz options.</div>
          </div>
          <button class="btn" id="backHomeBtn" type="button">Back</button>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Select by grade</div>

          <div class="gradeLines">
            <div class="gradeLine">
              <label class="check"><input id="chkG1" type="checkbox"> Grade 1</label>
              <span class="gradeRight">
                <span class="pill pillTiny" id="dlStatusG1">…</span>
                <button class="btn btnSmall" id="btnDlG1" type="button">Download</button>
              </span>
            </div>

            <div class="gradeLine">
              <label class="check"><input id="chkG2" type="checkbox"> Grade 2</label>
              <span class="gradeRight">
                <span class="pill pillTiny" id="dlStatusG2">…</span>
                <button class="btn btnSmall" id="btnDlG2" type="button">Download</button>
              </span>
            </div>

            <div class="gradeLine">
              <label class="check"><input id="chkG3" type="checkbox"> Grade 3</label>
              <span class="gradeRight">
                <span class="pill pillTiny" id="dlStatusG3">…</span>
                <button class="btn btnSmall" id="btnDlG3" type="button">Download</button>
              </span>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <button class="btn" id="openKanjiPickerBtn" type="button">Select individual kanji…</button>
            <div class="pill" id="overridePill">Overrides: …</div>
          </div>

          <div class="muted" style="margin-top:8px;">
            Downloading a grade stores its meaning images locally for offline use. The game will only use cached images.
          </div>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Quiz options</div>
          <label class="check">
            <input id="chkCompound" type="checkbox">
            Include compound word questions
          </label>
        </div>

        <div class="settingsCard">
          <div class="sectionTitle">Storage</div>
          <div class="row" style="margin-top:8px;">
            <button class="btn" id="resetSettingsBtn" type="button">Reset settings</button>
            <button class="btn" id="clearOverridesBtn" type="button">Clear all overrides</button>
            <button class="btn" id="resetDownloadsBtn" type="button">Reset downloads</button>
            <div class="pill" id="savedPill">Saved</div>
          </div>
          <div class="muted" style="margin-top:8px;">
            “Reset downloads” only resets the download flags so you can re-download updated images.
          </div>
        </div>
      </section>

      <!-- KANJI PICKER -->
      <section class="view" id="viewKanji" aria-labelledby="tabKanji">
        <div class="row">
          <div>
            <div class="sectionTitle">Kanji picker</div>
            <div class="muted">Tap kanji to toggle. Ordered by kyoiku_index within each grade.</div>
          </div>
          <button class="btn" id="kanjiBackBtn" type="button">Back</button>
        </div>

        <div class="row" style="margin-top:10px;">
          <div class="pill" id="kanjiPickerStatus">Loading…</div>
          <button class="btn" id="kanjiPickerRefreshBtn" type="button">Refresh</button>
        </div>

        <div id="kanjiGroups"></div>
      </section>

      <!-- DICTIONARY -->
      <section class="view" id="viewDictionary" aria-labelledby="tabDictionary">
        <div class="row">
          <div>
            <div class="sectionTitle">Dictionary</div>
            <div class="muted">Search kanji and view details.</div>
          </div>
          <button class="btn" id="dictBackBtn" type="button">Back</button>
        </div>

        <div class="dictTop">
          <input id="dictSearch" class="input" type="search" placeholder="Search: 漢字 / よみ / label…" autocomplete="off" />
          <div class="pill" id="dictStatusPill">…</div>
        </div>

        <div class="dictLayout">
          <div class="dictListPane">
            <div class="dictListHeader">
              <div class="muted" id="dictCount">0 results</div>
              <button class="btn btnSmall" id="dictClearBtn" type="button">Clear</button>
            </div>
            <div class="dictList" id="dictList"></div>
          </div>

          <div class="dictDetailPane">
            <div class="dictDetailEmpty" id="dictEmpty">
              Select a kanji from the list to view details.
            </div>

            <div class="dictDetail" id="dictDetail" style="display:none;">
              <div class="dictDetailHeader">
                <div class="dictBigKanji" id="dictBigKanji">本</div>
                <div class="chips" id="dictChips"></div>
              </div>

              <div class="dictRows" id="dictRows"></div>

              <div class="sectionTitle" style="margin-top:10px;">Raw JSON</div>
              <pre class="mono" id="dictRaw"></pre>
            </div>
          </div>
        </div>
      </section>

      <!-- WORD DETAIL -->
      <section class="view" id="viewWord">
        <div class="row">
          <div>
            <div class="sectionTitle">Word detail</div>
            <div class="muted">From the word block in the kanji JSON.</div>
          </div>
          <button class="btn" id="wordBackBtn" type="button">Back</button>
        </div>

        <div class="settingsCard">
          <div class="row" style="justify-content:flex-start;">
            <div class="dictBigKanji" id="wordBig">学校</div>
            <div class="chips" id="wordChips"></div>
          </div>

          <div class="dictRows" id="wordRows" style="margin-top:10px;"></div>

          <div class="sectionTitle" style="margin-top:10px;">Raw word JSON</div>
          <pre class="mono" id="wordRaw"></pre>
        </div>
      </section>

      <!-- GAME -->
      <section class="view" id="viewGame" aria-labelledby="tabGame">
        <div class="prompt" id="prompt" title="Tap to Sneak Peek">
          <div class="promptHud" aria-hidden="true">
            <div class="promptHudItem promptHudLives" id="hudLives">❤️ 10</div>
            <div class="promptHudItem promptHudScore" id="hudScore">0</div>
          </div>
          <div class="promptInner" id="promptInner">
            <div class="kanjiText">？</div>
          </div>
        </div>

        <div class="choices" id="choices"></div>

        <div class="history">
          <div class="historyHeader">
            <div class="historyTitle">History</div>
            <div class="historyHint">Tap a row to view details (no penalty).</div>
          </div>
          <div id="historyList"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- Game Over Modal -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2 id="gameOverTitle">Game over</h2>
      <p id="gameOverText">Final score: 0</p>
      <div class="actions">
        <button class="btn" id="gameOverOk" type="button">Back to Home</button>
      </div>
    </div>
  </div>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
